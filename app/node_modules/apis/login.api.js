exports.login = function(req, res){
  var api = 'login'
    , body = {}
    ;
  if(req.headers.auth === undefined ||
     req.headers.auth !== api){return res.end();}

  var email = req.body.email || ''
    , passw = req.body.password || ''
    ;
  if(email === '' ||
     passw === ''){return res.end()};
//------------------------------------------------------


  res.set('Content-Type', 'application/json');

  ldap.validate(email, passw, function(data){
      if(data.result){
        body.userID = data.userID;
        session.insert(body, function(e,r){
          if(e){return res.status(500).json({error: "API:"+api+": "+e})};
          delete body._id;
          body.result = data.result;
          res.set('Auth', body.sessID);
          res.json(body);
        });
      } else {
        data.userID = 0;
        res.set('Auth', api);
        res.json(data);
      }
  });
}

